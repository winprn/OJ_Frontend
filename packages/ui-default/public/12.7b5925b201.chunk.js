(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1041:function(M,P,t){"use strict";(function(d){var m=t(93),l=t.n(m),D=t(116),p=t.n(D),h=t(190),u=t(602),g=t.n(u),f=t(114),O=t(1042);const I=E=>({activeId:E.activeId,dialogues:E.dialogues}),v=E=>({handleClick(i){E({type:"DIALOGUES_SWITCH_TO",payload:i})}});P.a=Object(h.connect)(I,v)(class extends l.a.PureComponent{componentDidMount(){d(this.refs.list).scrollLock({strict:!0})}render(){const i=p.a.orderBy(p.a.values(this.props.dialogues),r=>p.a.maxBy(r.messages,"_id")?p.a.maxBy(r.messages,"_id")._id:Number.POSITIVE_INFINITY,"desc");return l.a.createElement("ol",{className:"messagepad__list",ref:"list"},p.a.map(i,r=>l.a.createElement(O.a,{key:r._id,userName:r.udoc.uname,summary:p.a.last(r.messages)?p.a.last(r.messages).flag&4?Object(f.a)("[Richtext message]"):p.a.last(r.messages).content:"",faceUrl:r.udoc.avatarUrl,active:r._id===this.props.activeId,onClick:()=>this.props.handleClick(r._id)})))}})}).call(this,t(95))},1042:function(M,P,t){"use strict";(function(d){t.d(P,"a",function(){return E});var m=t(136),l=t.n(m),D=t(140),p=t.n(D),h=Object.defineProperty,u=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,O=(i,r,o)=>r in i?h(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,I=(i,r)=>{for(var o in r||(r={}))g.call(r,o)&&O(i,o,r[o]);if(u)for(var o of u(r))f.call(r,o)&&O(i,o,r[o]);return i},v=(i,r)=>{var o={};for(var e in i)g.call(i,e)&&r.indexOf(e)<0&&(o[e]=i[e]);if(i!=null&&u)for(var e of u(i))r.indexOf(e)<0&&f.call(i,e)&&(o[e]=i[e]);return o};function E(i){const r=i,{userName:o,summary:e,faceUrl:a,active:n,onClick:s,className:c}=r,_=v(r,["userName","summary","faceUrl","active","onClick","className"]),C=p()(c,"messagepad__list-item media",{active:n});return d.createElement("li",I({},_),d.createElement("a",{className:C,onClick:s},d.createElement("div",{className:"media__left middle"},d.createElement("img",{src:a,alt:"avatar",width:"50",height:"50",className:"medium user-profile-avatar"})),d.createElement("div",{className:"media__body middle"},d.createElement("h3",{className:"messagepad__username"},o),d.createElement("div",{className:"messagepad__desc"},e))))}E.propTypes={userName:l.a.string.isRequired,summary:l.a.string.isRequired,faceUrl:l.a.string.isRequired,active:l.a.bool,onClick:l.a.func,className:l.a.string}}).call(this,t(93))},1043:function(M,P,t){"use strict";(function(d){var m=t(93),l=t.n(m),D=t(190),p=t(603),h=t(380),u=t.n(h),g=t(602),f=t.n(g),O=t(265),I=t.n(O),v=t(114),E=t(311),i=t(1044);const r=o=>({activeId:o.activeId,item:o.activeId!==null?o.dialogues[o.activeId]:null});P.a=Object(D.connect)(r)(class extends l.a.PureComponent{componentDidMount(){d(this.refs.list).scrollLock({strict:!0})}componentDidUpdate(e){const a=this.refs.list;if(this.props.activeId!==e.activeId?(this.scrollToBottom=!0,this.scrollWithAnimation=!1):a.scrollTop+a.offsetHeight===a.scrollHeight?(this.scrollToBottom=!0,this.scrollWithAnimation=!0):this.scrollToBottom=!1,this.scrollToBottom){const n=a.scrollHeight-a.offsetHeight;this.scrollWithAnimation?d(a).stop().animate({scrollTop:n},200,"easeOutCubic"):a.scrollTop=n}}renderContent(e){if(e.from===1){try{const a=JSON.parse(e.content),s=Object(v.a)(a.message).replace(/\{([^{}]+)\}/g,(c,_)=>`%substitude%${_}%substitude%`).split("%substitude%");a.params=a.params||{};for(let c=1;c<s.length;c+=2)if(s[c].endsWith(":link")){const _=a.params[s[c].split(":link")[0]];if(!_)continue;s[c]=l.a.createElement("a",{style:{color:"wheat"},href:_,key:c,target:"_blank",rel:"noreferrer"},_)}else s[c]=l.a.createElement("span",{style:{color:"wheat"},key:c},a.params[s[c]]);return s}catch(a){}return Object(v.a)(e.content)}return e.content}renderInner(){return this.props.activeId===null?[]:this.props.item.messages.map(e=>l.a.createElement(i.a,{key:e._id,isSelf:e.from===UserContext._id,faceUrl:e.from===UserContext._id?UserContext.avatarUrl:this.props.item.udoc.avatarUrl},l.a.createElement("div",null,this.renderContent(e)),l.a.createElement("time",{"data-tooltip":u()(Object(E.a)(e._id).timestamp*1e3).format("YYYY-MM-DD HH:mm:ss")},l.a.createElement(p.a,{datetime:Object(E.a)(e._id).timestamp*1e3,locale:Object(v.a)("timeago_locale")}))))}render(){return l.a.createElement("ol",{className:"messagepad__content",ref:"list"},this.renderInner())}})}).call(this,t(95))},1044:function(M,P,t){"use strict";(function(d){t.d(P,"a",function(){return o});var m=t(136),l=t.n(m),D=t(140),p=t.n(D),h=Object.defineProperty,u=Object.defineProperties,g=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,v=(e,a,n)=>a in e?h(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,E=(e,a)=>{for(var n in a||(a={}))O.call(a,n)&&v(e,n,a[n]);if(f)for(var n of f(a))I.call(a,n)&&v(e,n,a[n]);return e},i=(e,a)=>u(e,g(a)),r=(e,a)=>{var n={};for(var s in e)O.call(e,s)&&a.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&f)for(var s of f(e))a.indexOf(s)<0&&I.call(e,s)&&(n[s]=e[s]);return n};function o(e){const a=e,{faceUrl:n,isSelf:s,className:c,children:_}=a,C=r(a,["faceUrl","isSelf","className","children"]),y=p()(c,"messagepad__message",{"side--self":s,"side--other":!s});return d.createElement("li",i(E({},C),{className:y}),d.createElement("div",{className:"messagepad__message__avatar"},d.createElement("img",{src:n,alt:"avatar",width:"50",height:"50",className:"medium user-profile-avatar"})),d.createElement("div",{className:"messagepad__message__body"},_))}o.propTypes={isSelf:l.a.bool,faceUrl:l.a.string.isRequired,className:l.a.string,children:l.a.node}}).call(this,t(93))},1549:function(M,P,t){"use strict";t.r(P);var d=t(93),m=t.n(d),l=t(136),D=t.n(l),p=t(190),h=t(127),u=t(114),g=t(243),f=t(1041),O=t(1043),I=t(140),v=t.n(I),E;const i=s=>({activeId:s.activeId,isPosting:s.activeId!==null?s.isPosting[s.activeId]:!1,inputValue:s.activeId!==null?s.inputs[s.activeId]:""}),r=s=>({handleChange(c,_){c!==null&&s({type:"DIALOGUES_INPUT_CHANGED",payload:_,meta:{dialogueId:c}})},postSend(c,_){const C=h.a.post("",{operation:"send",uid:c,content:_});s({type:"DIALOGUES_POST_SEND",payload:C,meta:{dialogueId:c}})}});var o=Object(p.connect)(i,r)((E=class extends m.a.PureComponent{componentDidUpdate(s){if(this.focusInput=this.props.activeId!==s.activeId||s.isPosting!==this.props.isPosting&&this.props.isPosting===!1,this.focusInput){const{scrollX:c,scrollY:_}=window;this.refs.input.focus(),window.scrollTo(c,_)}}handleKeyDown(s){s.keyCode===13&&(s.ctrlKey||s.metaKey)&&this.submit()}submit(){this.props.postSend(this.props.activeId,this.props.inputValue)}render(){const s=v()("messagepad__input",{visible:this.props.activeId!==null});return m.a.createElement("div",{className:s},m.a.createElement("div",{className:"messagepad__textarea-container"},m.a.createElement("textarea",{ref:"input","data-markdown":!0,disabled:this.props.isPosting,value:this.props.inputValue,onKeyDown:c=>this.handleKeyDown(c),onChange:c=>this.props.handleChange(this.props.activeId,c.target.value)})),m.a.createElement("button",{disabled:!this.props.inputValue.trim().length||this.props.isPosting,onClick:()=>this.submit()},m.a.createElement(g.a,{name:"send"})))}},E.contextTypes={store:D.a.object},E)),e;const a=s=>({loadDialogues(){s({type:"DIALOGUES_LOAD_DIALOGUES",payload:h.a.get("")})}});var n=P.default=Object(p.connect)(null,a)((e=class extends m.a.PureComponent{componentDidMount(){this.props.loadDialogues()}render(){return m.a.createElement("div",{className:"messagepad clearfix"},m.a.createElement("div",{className:"messagepad__sidebar"},m.a.createElement("div",{className:"section__header"},m.a.createElement("button",{onClick:()=>this.props.onAdd(),className:"primary rounded button"},m.a.createElement(g.a,{name:"add"})," ",Object(u.a)("New"))),m.a.createElement(f.a,null)),m.a.createElement(O.a,null),m.a.createElement(o,null))}},e.propTypes={onAdd:D.a.func.isRequired},e))},243:function(M,P,t){"use strict";(function(d){t.d(P,"a",function(){return o});var m=t(136),l=t.n(m),D=t(140),p=t.n(D),h=Object.defineProperty,u=Object.defineProperties,g=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,v=(e,a,n)=>a in e?h(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,E=(e,a)=>{for(var n in a||(a={}))O.call(a,n)&&v(e,n,a[n]);if(f)for(var n of f(a))I.call(a,n)&&v(e,n,a[n]);return e},i=(e,a)=>u(e,g(a)),r=(e,a)=>{var n={};for(var s in e)O.call(e,s)&&a.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&f)for(var s of f(e))a.indexOf(s)<0&&I.call(e,s)&&(n[s]=e[s]);return n};function o(e){const a=e,{name:n,className:s}=a,c=r(a,["name","className"]),_=p()(s,`icon icon-${n}`);return d.createElement("span",i(E({},c),{className:_}))}o.propTypes={name:l.a.string.isRequired,className:l.a.string}}).call(this,t(93))}}]);
